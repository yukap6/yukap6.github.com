<!DOCTYPE html><html>

<head>
<meta charset="utf-8">
<title>index</title>
<style>
@font-face {
  font-family: octicons-anchor;
  src: url(data:font/woff;charset=utf-8;base64,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) format('woff');
}

body {
  background-color: white;
}

.markdown-body {
  min-width: 200px;
  max-width: 760px;
  margin: 0 auto;
  padding: 20px;

  -ms-text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%;
  color: #333;
  overflow: hidden;
  font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif;
  font-size: 16px;
  line-height: 1.6;
  word-wrap: break-word;
}

.markdown-body a {
  background: transparent;;word-wrap: break-word; word-break: break-all;
}

.markdown-body a:active,
.markdown-body a:hover {
  outline: 0;
}

.markdown-body strong {
  font-weight: bold;
}

.markdown-body h1 {
  font-size: 2em;
  margin: 0.67em 0;
}

.markdown-body img {
  border: 0;
}

.markdown-body hr {
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  height: 0;
}

.markdown-body pre {
  overflow: auto;
}

.markdown-body code,
.markdown-body kbd,
.markdown-body pre {
  font-family: monospace, monospace;
  font-size: 1em;
}

.markdown-body input {
  color: inherit;
  font: inherit;
  margin: 0;
}

.markdown-body html input[disabled] {
  cursor: default;
}

.markdown-body input {
  line-height: normal;
}

.markdown-body input[type="checkbox"] {
  -moz-box-sizing: border-box;
  box-sizing: border-box;
  padding: 0;
}

.markdown-body table {
  border-collapse: collapse;
  border-spacing: 0;
}

.markdown-body td,
.markdown-body th {
  padding: 0;
}

.markdown-body * {
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body input {
  font: 13px/1.4 Helvetica, arial, freesans, clean, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol";
}

.markdown-body a {
  color: #4183c4;
  text-decoration: none;
}

.markdown-body a:hover,
.markdown-body a:focus,
.markdown-body a:active {
  text-decoration: underline;
}

.markdown-body hr {
  height: 0;
  margin: 15px 0;
  overflow: hidden;
  background: transparent;
  border: 0;
  border-bottom: 1px solid #ddd;
}

.markdown-body hr:before {
  display: table;
  content: "";
}

.markdown-body hr:after {
  display: table;
  clear: both;
  content: "";
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  margin-top: 15px;
  margin-bottom: 15px;
  line-height: 1.1;
}

.markdown-body h1 {
  font-size: 30px;
}

.markdown-body h2 {
  font-size: 21px;
}

.markdown-body h3 {
  font-size: 16px;
}

.markdown-body h4 {
  font-size: 14px;
}

.markdown-body h5 {
  font-size: 12px;
}

.markdown-body h6 {
  font-size: 11px;
}

.markdown-body blockquote {
  margin: 0;
}

.markdown-body ul,
.markdown-body ol {
  padding: 0;
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body ol ol,
.markdown-body ul ol {
  list-style-type: lower-roman;
}

.markdown-body ul ul ol,
.markdown-body ul ol ol,
.markdown-body ol ul ol,
.markdown-body ol ol ol {
  list-style-type: lower-alpha;
}

.markdown-body dd {
  margin-left: 0;
}

.markdown-body code {
  font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace;
}

.markdown-body pre {
  margin-top: 0;
  margin-bottom: 0;
  font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace;
}

.markdown-body kbd {
  background-color: #e7e7e7;
  background-image: -webkit-linear-gradient(#fefefe, #e7e7e7);
  background-image: linear-gradient(#fefefe, #e7e7e7);
  background-repeat: repeat-x;
  border-radius: 2px;
  border: 1px solid #cfcfcf;
  color: #000;
  padding: 3px 5px;
  line-height: 10px;
  font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
  display: inline-block;
}

.markdown-body>*:first-child {
  margin-top: 0 !important;
}

.markdown-body>*:last-child {
  margin-bottom: 0 !important;
}

.markdown-body .anchor {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  display: block;
  padding-right: 6px;
  padding-left: 30px;
  margin-left: -30px;
}

.markdown-body .anchor:focus {
  outline: none;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  position: relative;
  margin-top: 1em;
  margin-bottom: 16px;
  font-weight: bold;
  line-height: 1.4;
}

.markdown-body h1 .octicon-link,
.markdown-body h2 .octicon-link,
.markdown-body h3 .octicon-link,
.markdown-body h4 .octicon-link,
.markdown-body h5 .octicon-link,
.markdown-body h6 .octicon-link {
  display: none;
  color: #000;
  vertical-align: middle;
}

.markdown-body h1:hover .anchor,
.markdown-body h2:hover .anchor,
.markdown-body h3:hover .anchor,
.markdown-body h4:hover .anchor,
.markdown-body h5:hover .anchor,
.markdown-body h6:hover .anchor {
  height: 1em;
  padding-left: 8px;
  margin-left: -30px;
  line-height: 1;
  text-decoration: none;
}

.markdown-body h1:hover .anchor .octicon-link,
.markdown-body h2:hover .anchor .octicon-link,
.markdown-body h3:hover .anchor .octicon-link,
.markdown-body h4:hover .anchor .octicon-link,
.markdown-body h5:hover .anchor .octicon-link,
.markdown-body h6:hover .anchor .octicon-link {
  display: inline-block;
}

.markdown-body h1 {
  padding-bottom: 0.3em;
  font-size: 2.25em;
  line-height: 1.2;
  border-bottom: 1px solid #eee;
}

.markdown-body h2 {
  padding-bottom: 0.3em;
  font-size: 1.75em;
  line-height: 1.225;
  border-bottom: 1px solid #eee;
}

.markdown-body h3 {
  font-size: 1.5em;
  line-height: 1.43;
}

.markdown-body h4 {
  font-size: 1.25em;
}

.markdown-body h5 {
  font-size: 1em;
}

.markdown-body h6 {
  font-size: 1em;
  color: #777;
}

.markdown-body p,
.markdown-body blockquote,
.markdown-body ul,
.markdown-body ol,
.markdown-body dl,
.markdown-body table,
.markdown-body pre {
  margin-top: 0;
  margin-bottom: 16px;
}

.markdown-body hr {
  height: 4px;
  padding: 0;
  margin: 16px 0;
  background-color: #e7e7e7;
  border: 0 none;
}

.markdown-body ul,
.markdown-body ol {
  padding-left: 2em;
}

.markdown-body ul ul,
.markdown-body ul ol,
.markdown-body ol ol,
.markdown-body ol ul {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body li>p {
  margin-top: 16px;
}

.markdown-body dl {
  padding: 0;
}

.markdown-body dl dt {
  padding: 0;
  margin-top: 16px;
  font-size: 1em;
  font-style: italic;
  font-weight: bold;
}

.markdown-body dl dd {
  padding: 0 16px;
  margin-bottom: 16px;
}

.markdown-body blockquote {
  padding: 0 15px;
  color: #777;
  border-left: 4px solid #ddd;
}

.markdown-body blockquote>:first-child {
  margin-top: 0;
}

.markdown-body blockquote>:last-child {
  margin-bottom: 0;
}

.markdown-body table {
  display: block;
  width: 100%;
  overflow: auto;
  word-break: normal;
  word-break: keep-all;
}

.markdown-body table th {
  font-weight: bold;
}

.markdown-body table th,
.markdown-body table td {
  padding: 6px 13px;
  border: 1px solid #ddd;
}

.markdown-body table tr {
  background-color: #fff;
  border-top: 1px solid #ccc;
}

.markdown-body table tr:nth-child(2n) {
  background-color: #f8f8f8;
}

.markdown-body img {
  max-width: 100%;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
  box-shadow: 0px 2px 8px 0px rgba(0, 0, 0, 0.1);
}

.markdown-body code {
  padding: 0;
  padding-top: 0.2em;
  padding-bottom: 0.2em;
  margin: 0;
  font-size: 85%;
  background-color: rgba(0,0,0,0.04);
  border-radius: 3px;
}

.markdown-body code:before,
.markdown-body code:after {
  letter-spacing: -0.2em;
  content: "\00a0";
}

.markdown-body pre>code {
  padding: 0;
  margin: 0;
  font-size: 100%;
  word-break: normal;
  white-space: pre;
  background: transparent;
  border: 0;
}

.markdown-body .highlight {
  margin-bottom: 16px;
}

.markdown-body .highlight pre,
.markdown-body pre {
  padding: 16px;
  overflow: auto;
  font-size: 85%;
  line-height: 1.45;
  background-color: #f7f7f7;
  border-radius: 3px;
}

.markdown-body .highlight pre {
  margin-bottom: 0;
  word-break: normal;
}

.markdown-body pre {
  word-wrap: normal;
}

.markdown-body pre code {
  display: inline;
  max-width: initial;
  padding: 0;
  margin: 0;
  overflow: initial;
  line-height: inherit;
  word-wrap: normal;
  background-color: transparent;
  border: 0;
}

.markdown-body pre code:before,
.markdown-body pre code:after {
  content: normal;
}

.markdown-body .highlight {
  background: #fff;
}

.markdown-body .highlight .mf,
.markdown-body .highlight .mh,
.markdown-body .highlight .mi,
.markdown-body .highlight .mo,
.markdown-body .highlight .il,
.markdown-body .highlight .m {
  color: #945277;
}

.markdown-body .highlight .s,
.markdown-body .highlight .sb,
.markdown-body .highlight .sc,
.markdown-body .highlight .sd,
.markdown-body .highlight .s2,
.markdown-body .highlight .se,
.markdown-body .highlight .sh,
.markdown-body .highlight .si,
.markdown-body .highlight .sx,
.markdown-body .highlight .s1 {
  color: #df5000;
}

.markdown-body .highlight .kc,
.markdown-body .highlight .kd,
.markdown-body .highlight .kn,
.markdown-body .highlight .kp,
.markdown-body .highlight .kr,
.markdown-body .highlight .kt,
.markdown-body .highlight .k,
.markdown-body .highlight .o {
  font-weight: bold;
}

.markdown-body .highlight .kt {
  color: #458;
}

.markdown-body .highlight .c,
.markdown-body .highlight .cm,
.markdown-body .highlight .c1 {
  color: #998;
  font-style: italic;
}

.markdown-body .highlight .cp,
.markdown-body .highlight .cs {
  color: #999;
  font-weight: bold;
}

.markdown-body .highlight .cs {
  font-style: italic;
}

.markdown-body .highlight .n {
  color: #333;
}

.markdown-body .highlight .na,
.markdown-body .highlight .nv,
.markdown-body .highlight .vc,
.markdown-body .highlight .vg,
.markdown-body .highlight .vi {
  color: #008080;
}

.markdown-body .highlight .nb {
  color: #0086B3;
}

.markdown-body .highlight .nc {
  color: #458;
  font-weight: bold;
}

.markdown-body .highlight .no {
  color: #094e99;
}

.markdown-body .highlight .ni {
  color: #800080;
}

.markdown-body .highlight .ne {
  color: #990000;
  font-weight: bold;
}

.markdown-body .highlight .nf {
  color: #945277;
  font-weight: bold;
}

.markdown-body .highlight .nn {
  color: #555;
}

.markdown-body .highlight .nt {
  color: #000080;
}

.markdown-body .highlight .err {
  color: #a61717;
  background-color: #e3d2d2;
}

.markdown-body .highlight .gd {
  color: #000;
  background-color: #fdd;
}

.markdown-body .highlight .gd .x {
  color: #000;
  background-color: #faa;
}

.markdown-body .highlight .ge {
  font-style: italic;
}

.markdown-body .highlight .gr {
  color: #aa0000;
}

.markdown-body .highlight .gh {
  color: #999;
}

.markdown-body .highlight .gi {
  color: #000;
  background-color: #dfd;
}

.markdown-body .highlight .gi .x {
  color: #000;
  background-color: #afa;
}

.markdown-body .highlight .go {
  color: #888;
}

.markdown-body .highlight .gp {
  color: #555;
}

.markdown-body .highlight .gs {
  font-weight: bold;
}

.markdown-body .highlight .gu {
  color: #800080;
  font-weight: bold;
}

.markdown-body .highlight .gt {
  color: #aa0000;
}

.markdown-body .highlight .ow {
  font-weight: bold;
}

.markdown-body .highlight .w {
  color: #bbb;
}

.markdown-body .highlight .sr {
  color: #017936;
}

.markdown-body .highlight .ss {
  color: #8b467f;
}

.markdown-body .highlight .bp {
  color: #999;
}

.markdown-body .highlight .gc {
  color: #999;
  background-color: #EAF2F5;
}

.markdown-body .octicon {
  font: normal normal 16px octicons-anchor;
  line-height: 1;
  display: inline-block;
  text-decoration: none;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.markdown-body .octicon-link:before {
  content: '\f05c';
}

.markdown-body .task-list-item {
  list-style-type: none;
}

.markdown-body .task-list-item+.task-list-item {
  margin-top: 3px;
}

.markdown-body .task-list-item input {
  float: left;
  margin: 0.3em 0 0.25em -1.6em;
  vertical-align: middle;
}
table td{ word-wrap: break-word !important; word-break: break-all !important; }
/*

github.com style (c) Vasily Polovnyov <vast@whiteants.net>

*/

.hljs {
  display: block;
  overflow-x: auto;
  padding: 0.5em;
  color: #333;
  background: #f8f8f8;
  -webkit-text-size-adjust: none;
}

.hljs-comment,
.diff .hljs-header {
  color: #998;
  font-style: italic;
}

.hljs-keyword,
.css .rule .hljs-keyword,
.hljs-winutils,
.nginx .hljs-title,
.hljs-subst,
.hljs-request,
.hljs-status {
  color: #333;
  font-weight: bold;
}

.hljs-number,
.hljs-hexcolor,
.ruby .hljs-constant {
  color: #008080;
}

.hljs-string,
.hljs-tag .hljs-value,
.hljs-doctag,
.tex .hljs-formula {
  color: #d14;
}

.hljs-title,
.hljs-id,
.scss .hljs-preprocessor {
  color: #900;
  font-weight: bold;
}

.hljs-list .hljs-keyword,
.hljs-subst {
  font-weight: normal;
}

.hljs-class .hljs-title,
.hljs-type,
.vhdl .hljs-literal,
.tex .hljs-command {
  color: #458;
  font-weight: bold;
}

.hljs-tag,
.hljs-tag .hljs-title,
.hljs-rule .hljs-property,
.django .hljs-tag .hljs-keyword {
  color: #000080;
  font-weight: normal;
}

.hljs-attribute,
.hljs-variable,
.lisp .hljs-body,
.hljs-name {
  color: #008080;
}

.hljs-regexp {
  color: #009926;
}

.hljs-symbol,
.ruby .hljs-symbol .hljs-string,
.lisp .hljs-keyword,
.clojure .hljs-keyword,
.scheme .hljs-keyword,
.tex .hljs-special,
.hljs-prompt {
  color: #990073;
}

.hljs-built_in {
  color: #0086b3;
}

.hljs-preprocessor,
.hljs-pragma,
.hljs-pi,
.hljs-doctype,
.hljs-shebang,
.hljs-cdata {
  color: #999;
  font-weight: bold;
}

.hljs-deletion {
  background: #fdd;
}

.hljs-addition {
  background: #dfd;
}

.diff .hljs-change {
  background: #0086b3;
}

.hljs-chunk {
  color: #aaa;
}


</style>
</head><body><div class="markdown-body">

<h1 id="contextthis">上下文（context）—— <code>this</code></h1>
<p><img src="http://www.iseeit.cn/wp-content/uploads/2019/07/try-this.gif" alt="" /></p>
<p>JavaScript 的上下文（context）即 <code>this</code> 对象，表示当前执行代码的环境对象。由于 <code>this</code> 对象的不固定，且可以在代码执行阶段动态变化，常常会令初学者困惑。本文的目的旨在运用<strong>就近原则</strong>（自己 YY 创造的概念，且看下文）来解释清楚这个问题。</p>
<blockquote>
  <p>为了方便描述，统一用 <code>this</code> 来指代上下文（context），因为上下文就是 <code>this</code>。</p>
</blockquote>
<p><code>this</code> 对象有2种环境：</p>
<ul>
<li>全局环境；</li>
<li>函数环境（运行时）。</li>
</ul>
<h2 id="">全局环境</h2>
<p>在浏览器中，<code>this</code> 在全局环境指向的是 <code>window</code> 对象（严格模式也是一样的）。</p>
<pre><code>this === window; // true
</code></pre>
<p>在 nodeJs 环境中，<code>this</code> 指向顶级全局对象 <code>global</code>。</p>
<pre><code>this === global; // true
</code></pre>
<h2 id="-1">函数环境</h2>
<p>在函数内部，<code>this</code> 的值取决于函数被调用的方式。一般而言，<code>this</code> 指向离函数最近的调用对象，为了方便理解和记忆，简称<strong>就近原则</strong>。下面通过一些常见的调用方式来详解 <code>this</code> 在函数内的表现。</p>
<h3 id="-2">简单调用</h3>
<pre><code>function f() {
  return this;
}
f() === window; // true
window.f() === window; // true
</code></pre>
<p>在浏览器环境，函数 <code>f</code> 在全局定义，当函数被调用的时候，实质等同于 <code>window.f()</code>，根据<strong>就近原则</strong>，这里的 <code>this</code> 指向的就是调用函数 <code>f</code> 的对象 <code>window</code>。在 nodeJs 中表现一致，只是全局对象换成了 <code>global</code>。</p>
<p>需要补充的是，如果是在严格模式下，表现并不一致。</p>
<pre><code>'use strict';
function f() {
  return this;
}
f() === window; // false
f() === undefined; // true
window.f() === window; // true
</code></pre>
<p>在严格模式下，<code>f()</code> 执行时，根据<strong>就近原则</strong>，调用函数 <code>f</code> 的最近的对象并不存在，所以其对应的 <code>this</code> 指向了 <code>undefined</code>。但是以 <code>window.f()</code> 执行时，明确的指明了调用函数 <code>f</code> 的最近的对象是 <code>window</code>，符合<strong>就近原则</strong>。</p>
<h3 id="this">动态修改 <code>this</code> 对象</h3>
<p>使用 <code>call</code>、<code>apply</code> 以及 <code>bind</code> 方法都可以动态地修改函数内 <code>this</code> 指向。</p>
<pre><code>var o = {
  money: 1,
};
var money = 2;
function whichMoney() {
  return this.money;
}

whichMoney(); // 2
whichMoney.call(o); // 1
whichMoney.apply(o); // 1
</code></pre>
<p><code>whichMoney()</code> 直接执行的结果是 <code>2</code>，因为此时等同于代码 <code>window.whichMoney();</code>，在全局环境中，又存在 <code>var money = 2;</code>（相当于定义了 <code>window.money = 2</code>），故输出 <code>2</code>。</p>
<p>当使用 <code>call</code> 或者 <code>apply</code> 动态指定了函数 <code>whichMoney</code> 执行时的 <code>this</code> 对象后，输出结果为对象 <code>o</code> 的 <code>money</code> 属性值 <code>1</code>。</p>
<p><code>bind</code> 则不同，在改变函数内 <code>this</code> 指向时，<code>bind</code> 会将绑定的对象作为 <code>this</code> 指定给函数，且无论之后该函数在哪调用，以何种方式调用，<code>this</code> 的指向都不再变化。</p>
<pre><code>// 接上面代码
var fClone = whichMoney.bind(o); // bind 返回新的函数
fClone(); // 1
window.fClone(); // 1
whichMoney(); // 2
</code></pre>
<p>这里需要强调的是，<code>bind</code> 返回一个新的函数，该函数的 <code>this</code> 对象（这里是对象 <code>o</code>）会完全锁定，不再变化。<code>bind</code> 是为数不多 <code>this</code> 会被锁定的特例之一，可以理解为<strong>就近原则</strong>被固化了。</p>
<h3 id="-3">作为对象的方法</h3>
<p>当函数作为对象里的方法被调用时，它们的 <code>this</code> 是调用该函数的对象。</p>
<pre><code>var obj = {
  foo: function() {
    return this;
  },
};
obj.foo() === obj; // true
</code></pre>
<p>根据<strong>就近原则</strong>，调用函数 <code>foo</code> 的最近的对象是 <code>obj</code>，所以 <code>foo</code> 函数的 <code>this</code> 指向 <code>obj</code>。</p>
<pre><code>// 接上
var p = obj.foo;
p() === window; // true
</code></pre>
<p>此时，执行结果则完全不一样了。因为这里只是把 <code>foo</code> 函数赋值给了变量 <code>p</code>。当执行 <code>p</code> 时，相当于执行 <code>window.p()</code>，所以 <code>p</code> 对应的 <code>this</code> 则指向了最近的调用对象 <code>window</code>。遵循<strong>就近原则</strong>。</p>
<h3 id="-4">箭头函数</h3>
<p>箭头函数本身没有 <code>this</code> 对象，当箭头函数被<strong>创建</strong>时，离箭头函数最近的外层作用域的 <code>this</code> 会被永久绑定到箭头函数，所以箭头函数也遵循<strong>就近原则</strong>。举个栗子🌰：</p>
<pre><code>// 代码执行时，箭头函数 foo 被创建
// 因为箭头函数的创建已经完成，this 会立刻绑定，而此时最近的外层作用域的 this 指向全局对象 `window`
// 所以此时箭头函数 foo 的 this 和 window 绑定，不再改变
var foo = () =&gt; this;
var obj = { foo };
obj.foo() === window; // true
</code></pre>
<p>这里的重点在于箭头函数被<strong>创建</strong>时，<code>this</code> 才会被绑定（如果函数都没有被创建，也就没有绑定的事情），再举个栗子：</p>
<pre><code>var obj = {
  // 箭头函数 p 在 obj 对象定义时，就直接创建完成
  // 此时箭头函数 p 的 this 完成绑定
  // 因为此时，箭头函数最近的外层作用域指向全局对象 window，所以箭头函数 p 的 this 被绑定到了 window
  p: () =&gt; this,
};
obj.p() === window; // true
</code></pre>
<p>更复杂一点的栗子🌰：</p>
<pre><code>var obj = {
  foo: function() {
    // 这里的 this 只有在 foo 函数被执行时才会真正绑定，也就是箭头函数 x 被创建时，
    // 只要 foo 函数的代码不被执行，
    // 箭头函数 x 仍然只是定义在代码里，但一直未被创建，也就无所谓绑定
    var x = () =&gt; this;
    return x;
  }
};
// obj.foo() 执行时，返回 x, 此时，箭头函数 x 被创建，
// 且 x 的最近的外层作用域是函数 foo 的作用域，函数 foo 作用域的 this 对象指向了 obj，
// 则箭头函数 x 的 this 对象被永久的绑定到了 obj 对象
obj.foo()() === obj; // true
var fn = obj.foo();
var obj2 = {
  test: function() {
    return fn();
  },
};
obj2.test() === obj; // true，无论箭头函数在何处调用，其创建时的 this 不再改变
</code></pre>
<p>接上，一个更有趣的栗子🌰：</p>
<pre><code>// 注意此时只是把函数 foo 赋值给了变量 fn2,
// 函数 foo 的代码并没有被执行，所以，其内部的箭头函数 x 依然未被创建，
// 也就不存在绑定 this，只有当 fn2 执行时，才会发生 this 绑定
var fn2 = obj.foo;
fn2()() === window; // true
</code></pre>
<p><code>fn2()()</code> 的结果是 <code>window</code>，很奇怪吗？分解来看即可</p>
<ul>
<li>首先将 <code>obj.foo</code> 赋值给 <code>fn2</code>，则 <code>fn2</code> 此时就是函数 <code>foo</code>;</li>
<li>接着执行 <code>fn2()</code>，也就是 <code>foo</code> 函数执行，此时才真正创建箭头函数 <code>x</code>，因为此时 <code>fn2()</code> 作用域的 <code>this</code> 指向 <code>window</code>，所以箭头函数 <code>x</code> 的 <code>this</code> 被绑定到了全局对象 <code>window</code></li>
<li>因此执行 <code>fn2()()</code> 就相当于执行箭头函数 <code>x</code>, 所以结果为 <code>true</code></li>
</ul>
<p>箭头函数在被创建的时候，<code>this</code> 对象即会被绑定到离它最近的作用域的 <code>this</code> 对象。所以，关键在于确定箭头函数是否真正被<strong>创建</strong>。
而箭头函数被创建有一个简单的判断方法，那就是指向箭头函数的变量是否已经存在于内存中。如果代码执行完成，箭头函数已经存在于内存中，则 <code>this</code> 绑定完成；如果箭头函数还未存在于内存中，则就不存在 <code>this</code> 绑定，因为箭头函数本身还不存在呢。</p>
<h3 id="-5">构造函数</h3>
<p>当一个函数用作构造函数时（使用 <code>new</code> 关键字），它的 <code>this</code> 被绑定到正在构造的新对象。</p>
<pre><code>function Person(age) {
  this.age = age;
}
var jack = new Person(21);
jack.age; // 21
</code></pre>
<p>创建对象 <code>jack</code> 时，构造函数 <code>Person</code> 内的 <code>this</code> 被指向正在构造的新对象 <code>jack</code>，所以对象 <code>jack</code> 的 <code>age</code> 属性被创建。</p>
<h3 id="dom">DOM 事件处理函数</h3>
<p>当函数被用作事件处理函数时，它的 <code>this</code> 指向触发事件的元素（一些浏览器在使用非 <code>addEventListener</code> 的函数动态添加监听函数时不遵守这个约定，IE8 以下，<code>this</code> 指向 <code>window</code>）。</p>
<p>当代码被内联 <code>on-event</code> 处理函数调用时，它的 <code>this</code> 指向监听器所在的 DOM 元素。</p>
<pre><code>&lt;button onclick="alert(this.tagName.toLowerCase());"&gt;
  Show this
&lt;/button&gt;
</code></pre>
<p>点击按钮显示 <code>button</code>。注意只有外层代码中的 <code>this</code> 是这样设置的：</p>
<pre><code>&lt;button onclick="alert((function(){return this})());"&gt;
  Show inner this
&lt;/button&gt;
</code></pre>
<p>在这种情况下，没有设置内部函数的this，所以它指向 <code>global/window</code> 对象（即非严格模式下调用的函数未设置 <code>this</code> 时指向的默认对象）。</p>
<h2 id="-6">总结</h2>
<p>全局环境 <code>this</code> 一般指向全局对象，浏览器端是 <code>window</code> 对象，nodeJs 是 <code>global</code> 对象。</p>
<p>函数内的 <code>this</code> 遵循<strong>就近原则</strong>，指向调用函数的最近的对象。</p>
<p>箭头函数在创建时，就会绑定 <code>this</code> 对象，且其后不再改变，绑定的 <code>this</code> 对象从属于离箭头函数最近的作用域的 <code>this</code>。</p>
<p>理解了 <strong>就近原则</strong>，妈妈再也不用担心面试的时候被问到 <code>this</code> 的问题了。👻</p>
<p>（end）</p></div></body>

</html>
