<!DOCTYPE html><html>

<head>
<meta charset="utf-8">
<title>index</title>
<style>
@font-face {
  font-family: octicons-anchor;
  src: url(data:font/woff;charset=utf-8;base64,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) format('woff');
}

body {
  background-color: white;
}

.markdown-body {
  min-width: 200px;
  max-width: 760px;
  margin: 0 auto;
  padding: 20px;

  -ms-text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%;
  color: #333;
  overflow: hidden;
  font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif;
  font-size: 16px;
  line-height: 1.6;
  word-wrap: break-word;
}

.markdown-body a {
  background: transparent;;word-wrap: break-word; word-break: break-all;
}

.markdown-body a:active,
.markdown-body a:hover {
  outline: 0;
}

.markdown-body strong {
  font-weight: bold;
}

.markdown-body h1 {
  font-size: 2em;
  margin: 0.67em 0;
}

.markdown-body img {
  border: 0;
}

.markdown-body hr {
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  height: 0;
}

.markdown-body pre {
  overflow: auto;
}

.markdown-body code,
.markdown-body kbd,
.markdown-body pre {
  font-family: monospace, monospace;
  font-size: 1em;
}

.markdown-body input {
  color: inherit;
  font: inherit;
  margin: 0;
}

.markdown-body html input[disabled] {
  cursor: default;
}

.markdown-body input {
  line-height: normal;
}

.markdown-body input[type="checkbox"] {
  -moz-box-sizing: border-box;
  box-sizing: border-box;
  padding: 0;
}

.markdown-body table {
  border-collapse: collapse;
  border-spacing: 0;
}

.markdown-body td,
.markdown-body th {
  padding: 0;
}

.markdown-body * {
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body input {
  font: 13px/1.4 Helvetica, arial, freesans, clean, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol";
}

.markdown-body a {
  color: #4183c4;
  text-decoration: none;
}

.markdown-body a:hover,
.markdown-body a:focus,
.markdown-body a:active {
  text-decoration: underline;
}

.markdown-body hr {
  height: 0;
  margin: 15px 0;
  overflow: hidden;
  background: transparent;
  border: 0;
  border-bottom: 1px solid #ddd;
}

.markdown-body hr:before {
  display: table;
  content: "";
}

.markdown-body hr:after {
  display: table;
  clear: both;
  content: "";
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  margin-top: 15px;
  margin-bottom: 15px;
  line-height: 1.1;
}

.markdown-body h1 {
  font-size: 30px;
}

.markdown-body h2 {
  font-size: 21px;
}

.markdown-body h3 {
  font-size: 16px;
}

.markdown-body h4 {
  font-size: 14px;
}

.markdown-body h5 {
  font-size: 12px;
}

.markdown-body h6 {
  font-size: 11px;
}

.markdown-body blockquote {
  margin: 0;
}

.markdown-body ul,
.markdown-body ol {
  padding: 0;
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body ol ol,
.markdown-body ul ol {
  list-style-type: lower-roman;
}

.markdown-body ul ul ol,
.markdown-body ul ol ol,
.markdown-body ol ul ol,
.markdown-body ol ol ol {
  list-style-type: lower-alpha;
}

.markdown-body dd {
  margin-left: 0;
}

.markdown-body code {
  font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace;
}

.markdown-body pre {
  margin-top: 0;
  margin-bottom: 0;
  font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace;
}

.markdown-body kbd {
  background-color: #e7e7e7;
  background-image: -webkit-linear-gradient(#fefefe, #e7e7e7);
  background-image: linear-gradient(#fefefe, #e7e7e7);
  background-repeat: repeat-x;
  border-radius: 2px;
  border: 1px solid #cfcfcf;
  color: #000;
  padding: 3px 5px;
  line-height: 10px;
  font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
  display: inline-block;
}

.markdown-body>*:first-child {
  margin-top: 0 !important;
}

.markdown-body>*:last-child {
  margin-bottom: 0 !important;
}

.markdown-body .anchor {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  display: block;
  padding-right: 6px;
  padding-left: 30px;
  margin-left: -30px;
}

.markdown-body .anchor:focus {
  outline: none;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  position: relative;
  margin-top: 1em;
  margin-bottom: 16px;
  font-weight: bold;
  line-height: 1.4;
}

.markdown-body h1 .octicon-link,
.markdown-body h2 .octicon-link,
.markdown-body h3 .octicon-link,
.markdown-body h4 .octicon-link,
.markdown-body h5 .octicon-link,
.markdown-body h6 .octicon-link {
  display: none;
  color: #000;
  vertical-align: middle;
}

.markdown-body h1:hover .anchor,
.markdown-body h2:hover .anchor,
.markdown-body h3:hover .anchor,
.markdown-body h4:hover .anchor,
.markdown-body h5:hover .anchor,
.markdown-body h6:hover .anchor {
  height: 1em;
  padding-left: 8px;
  margin-left: -30px;
  line-height: 1;
  text-decoration: none;
}

.markdown-body h1:hover .anchor .octicon-link,
.markdown-body h2:hover .anchor .octicon-link,
.markdown-body h3:hover .anchor .octicon-link,
.markdown-body h4:hover .anchor .octicon-link,
.markdown-body h5:hover .anchor .octicon-link,
.markdown-body h6:hover .anchor .octicon-link {
  display: inline-block;
}

.markdown-body h1 {
  padding-bottom: 0.3em;
  font-size: 2.25em;
  line-height: 1.2;
  border-bottom: 1px solid #eee;
}

.markdown-body h2 {
  padding-bottom: 0.3em;
  font-size: 1.75em;
  line-height: 1.225;
  border-bottom: 1px solid #eee;
}

.markdown-body h3 {
  font-size: 1.5em;
  line-height: 1.43;
}

.markdown-body h4 {
  font-size: 1.25em;
}

.markdown-body h5 {
  font-size: 1em;
}

.markdown-body h6 {
  font-size: 1em;
  color: #777;
}

.markdown-body p,
.markdown-body blockquote,
.markdown-body ul,
.markdown-body ol,
.markdown-body dl,
.markdown-body table,
.markdown-body pre {
  margin-top: 0;
  margin-bottom: 16px;
}

.markdown-body hr {
  height: 4px;
  padding: 0;
  margin: 16px 0;
  background-color: #e7e7e7;
  border: 0 none;
}

.markdown-body ul,
.markdown-body ol {
  padding-left: 2em;
}

.markdown-body ul ul,
.markdown-body ul ol,
.markdown-body ol ol,
.markdown-body ol ul {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body li>p {
  margin-top: 16px;
}

.markdown-body dl {
  padding: 0;
}

.markdown-body dl dt {
  padding: 0;
  margin-top: 16px;
  font-size: 1em;
  font-style: italic;
  font-weight: bold;
}

.markdown-body dl dd {
  padding: 0 16px;
  margin-bottom: 16px;
}

.markdown-body blockquote {
  padding: 0 15px;
  color: #777;
  border-left: 4px solid #ddd;
}

.markdown-body blockquote>:first-child {
  margin-top: 0;
}

.markdown-body blockquote>:last-child {
  margin-bottom: 0;
}

.markdown-body table {
  display: block;
  width: 100%;
  overflow: auto;
  word-break: normal;
  word-break: keep-all;
}

.markdown-body table th {
  font-weight: bold;
}

.markdown-body table th,
.markdown-body table td {
  padding: 6px 13px;
  border: 1px solid #ddd;
}

.markdown-body table tr {
  background-color: #fff;
  border-top: 1px solid #ccc;
}

.markdown-body table tr:nth-child(2n) {
  background-color: #f8f8f8;
}

.markdown-body img {
  max-width: 100%;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body code {
  padding: 0;
  padding-top: 0.2em;
  padding-bottom: 0.2em;
  margin: 0;
  font-size: 85%;
  background-color: rgba(0,0,0,0.04);
  border-radius: 3px;
}

.markdown-body code:before,
.markdown-body code:after {
  letter-spacing: -0.2em;
  content: "\00a0";
}

.markdown-body pre>code {
  padding: 0;
  margin: 0;
  font-size: 100%;
  word-break: normal;
  white-space: pre;
  background: transparent;
  border: 0;
}

.markdown-body .highlight {
  margin-bottom: 16px;
}

.markdown-body .highlight pre,
.markdown-body pre {
  padding: 16px;
  overflow: auto;
  font-size: 85%;
  line-height: 1.45;
  background-color: #f7f7f7;
  border-radius: 3px;
}

.markdown-body .highlight pre {
  margin-bottom: 0;
  word-break: normal;
}

.markdown-body pre {
  word-wrap: normal;
}

.markdown-body pre code {
  display: inline;
  max-width: initial;
  padding: 0;
  margin: 0;
  overflow: initial;
  line-height: inherit;
  word-wrap: normal;
  background-color: transparent;
  border: 0;
}

.markdown-body pre code:before,
.markdown-body pre code:after {
  content: normal;
}

.markdown-body .highlight {
  background: #fff;
}

.markdown-body .highlight .mf,
.markdown-body .highlight .mh,
.markdown-body .highlight .mi,
.markdown-body .highlight .mo,
.markdown-body .highlight .il,
.markdown-body .highlight .m {
  color: #945277;
}

.markdown-body .highlight .s,
.markdown-body .highlight .sb,
.markdown-body .highlight .sc,
.markdown-body .highlight .sd,
.markdown-body .highlight .s2,
.markdown-body .highlight .se,
.markdown-body .highlight .sh,
.markdown-body .highlight .si,
.markdown-body .highlight .sx,
.markdown-body .highlight .s1 {
  color: #df5000;
}

.markdown-body .highlight .kc,
.markdown-body .highlight .kd,
.markdown-body .highlight .kn,
.markdown-body .highlight .kp,
.markdown-body .highlight .kr,
.markdown-body .highlight .kt,
.markdown-body .highlight .k,
.markdown-body .highlight .o {
  font-weight: bold;
}

.markdown-body .highlight .kt {
  color: #458;
}

.markdown-body .highlight .c,
.markdown-body .highlight .cm,
.markdown-body .highlight .c1 {
  color: #998;
  font-style: italic;
}

.markdown-body .highlight .cp,
.markdown-body .highlight .cs {
  color: #999;
  font-weight: bold;
}

.markdown-body .highlight .cs {
  font-style: italic;
}

.markdown-body .highlight .n {
  color: #333;
}

.markdown-body .highlight .na,
.markdown-body .highlight .nv,
.markdown-body .highlight .vc,
.markdown-body .highlight .vg,
.markdown-body .highlight .vi {
  color: #008080;
}

.markdown-body .highlight .nb {
  color: #0086B3;
}

.markdown-body .highlight .nc {
  color: #458;
  font-weight: bold;
}

.markdown-body .highlight .no {
  color: #094e99;
}

.markdown-body .highlight .ni {
  color: #800080;
}

.markdown-body .highlight .ne {
  color: #990000;
  font-weight: bold;
}

.markdown-body .highlight .nf {
  color: #945277;
  font-weight: bold;
}

.markdown-body .highlight .nn {
  color: #555;
}

.markdown-body .highlight .nt {
  color: #000080;
}

.markdown-body .highlight .err {
  color: #a61717;
  background-color: #e3d2d2;
}

.markdown-body .highlight .gd {
  color: #000;
  background-color: #fdd;
}

.markdown-body .highlight .gd .x {
  color: #000;
  background-color: #faa;
}

.markdown-body .highlight .ge {
  font-style: italic;
}

.markdown-body .highlight .gr {
  color: #aa0000;
}

.markdown-body .highlight .gh {
  color: #999;
}

.markdown-body .highlight .gi {
  color: #000;
  background-color: #dfd;
}

.markdown-body .highlight .gi .x {
  color: #000;
  background-color: #afa;
}

.markdown-body .highlight .go {
  color: #888;
}

.markdown-body .highlight .gp {
  color: #555;
}

.markdown-body .highlight .gs {
  font-weight: bold;
}

.markdown-body .highlight .gu {
  color: #800080;
  font-weight: bold;
}

.markdown-body .highlight .gt {
  color: #aa0000;
}

.markdown-body .highlight .ow {
  font-weight: bold;
}

.markdown-body .highlight .w {
  color: #bbb;
}

.markdown-body .highlight .sr {
  color: #017936;
}

.markdown-body .highlight .ss {
  color: #8b467f;
}

.markdown-body .highlight .bp {
  color: #999;
}

.markdown-body .highlight .gc {
  color: #999;
  background-color: #EAF2F5;
}

.markdown-body .octicon {
  font: normal normal 16px octicons-anchor;
  line-height: 1;
  display: inline-block;
  text-decoration: none;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.markdown-body .octicon-link:before {
  content: '\f05c';
}

.markdown-body .task-list-item {
  list-style-type: none;
}

.markdown-body .task-list-item+.task-list-item {
  margin-top: 3px;
}

.markdown-body .task-list-item input {
  float: left;
  margin: 0.3em 0 0.25em -1.6em;
  vertical-align: middle;
}
table td{ word-wrap: break-word !important; word-break: break-all !important; }
/*

github.com style (c) Vasily Polovnyov <vast@whiteants.net>

*/

.hljs {
  display: block;
  overflow-x: auto;
  padding: 0.5em;
  color: #333;
  background: #f8f8f8;
  -webkit-text-size-adjust: none;
}

.hljs-comment,
.diff .hljs-header {
  color: #998;
  font-style: italic;
}

.hljs-keyword,
.css .rule .hljs-keyword,
.hljs-winutils,
.nginx .hljs-title,
.hljs-subst,
.hljs-request,
.hljs-status {
  color: #333;
  font-weight: bold;
}

.hljs-number,
.hljs-hexcolor,
.ruby .hljs-constant {
  color: #008080;
}

.hljs-string,
.hljs-tag .hljs-value,
.hljs-doctag,
.tex .hljs-formula {
  color: #d14;
}

.hljs-title,
.hljs-id,
.scss .hljs-preprocessor {
  color: #900;
  font-weight: bold;
}

.hljs-list .hljs-keyword,
.hljs-subst {
  font-weight: normal;
}

.hljs-class .hljs-title,
.hljs-type,
.vhdl .hljs-literal,
.tex .hljs-command {
  color: #458;
  font-weight: bold;
}

.hljs-tag,
.hljs-tag .hljs-title,
.hljs-rule .hljs-property,
.django .hljs-tag .hljs-keyword {
  color: #000080;
  font-weight: normal;
}

.hljs-attribute,
.hljs-variable,
.lisp .hljs-body,
.hljs-name {
  color: #008080;
}

.hljs-regexp {
  color: #009926;
}

.hljs-symbol,
.ruby .hljs-symbol .hljs-string,
.lisp .hljs-keyword,
.clojure .hljs-keyword,
.scheme .hljs-keyword,
.tex .hljs-special,
.hljs-prompt {
  color: #990073;
}

.hljs-built_in {
  color: #0086b3;
}

.hljs-preprocessor,
.hljs-pragma,
.hljs-pi,
.hljs-doctype,
.hljs-shebang,
.hljs-cdata {
  color: #999;
  font-weight: bold;
}

.hljs-deletion {
  background: #fdd;
}

.hljs-addition {
  background: #dfd;
}

.diff .hljs-change {
  background: #0086b3;
}

.hljs-chunk {
  color: #aaa;
}


</style>
</head><body><div class="markdown-body">

<h1 id="htmloverflowhiddenbug">html overflow:hidden 引发页面返回顶部 bug 记录</h1>
<h2 id="">问题描述</h2>
<p>打开 <a href="https://codepen.io/yukap6/pen/wQgwbM">有 Bug Demo</a>，滚动鼠标到页面最底部，点击 <code>点我显示模态框</code> 按钮就会发现，页面莫名其妙的”回到了顶部“。而正常期望是，模态框显示在当前屏幕内容的正上方即可，背景内容不出现滚动，也不”回到顶部“，比如 <a href="https://codepen.io/yukap6/pen/VVPYqr">正常的 Demo</a> 所示（点击 <code>点我显示模态框</code> 按钮即可）。那为什么会出现”回到顶部“的情况呢？</p>
<h2 id="-1">解决方案</h2>
<p>经过仔细分析发现，当点击按钮让模态框显示的时候，为了让背景内容不出现滚动，<code>html</code> <code>body</code> 元素同时被添加了如下所示样式，而当不添加这些样式给 <code>html</code> <code>body</code> 元素时，页面就会恢复正常（但是背景内容会滚动）。那么问题就定位到了，添加的 CSS 样式有问题，如下所示</p>
<pre><code>  // html body 同时加入如下样式时有 bug
  width: 100%;
  height: 100%;
  overflow: hidden;
</code></pre>
<p>那么怎么做到既让模态框在当前屏幕正常显示，又能让背景内容固定不滚动，而且不会”回到顶部“呢？经过一系列测试，下面列出一些解决方案（具体原理会在稍后详细讨论）。</p>
<h3 id="1htmloverflowhidden">方案1，只给 <code>html</code> 元素添加 <code>overflow:hidden</code></h3>
<p>如 <a href="https://codepen.io/yukap6/pen/MzJwrJ">Demo</a> 所示，模态框正常显示。所做的调整就是将样式内容修改如下，并且只将该样式添加到 <code>html</code> 元素上。</p>
<pre><code>overflow: hidden;
</code></pre>
<h3 id="2bodyoverflowhidden">方案2，只给 <code>body</code> 元素添加 <code>overflow:hidden</code></h3>
<p>如 <a href="https://codepen.io/yukap6/pen/eQgpJM">Demo</a> 所示，模态框正常显示。所做的调整就是将样式内容修改如下，并且只将该样式添加到 <code>body</code> 元素上。</p>
<pre><code>overflow: hidden;
</code></pre>
<h3 id="3htmlbody">方案3，<code>html</code> <code>body</code> 元素添加不同的样式，采用”加法“将问题样式进行组合</h3>
<p>这里的思路就是以最简代码 <code>overflow:hidden</code> 为基础，一步一步将样式增加，直至全部代码加入导致”回到顶部“问题复现。</p>
<p><a href="https://codepen.io/yukap6/pen/wQgGjv"><strong>组合1</strong>（正常）</a></p>
<pre><code>html {
}
body {
  width: 100%;
  height: 100%;
  overflow: hidden;
}
</code></pre>
<p><a href="https://codepen.io/yukap6/pen/zMNBGa"><strong>组合2</strong>（正常）</a></p>
<pre><code>html {
  width: 100%;
  height: 100%;
  overflow: hidden;
}
body {
}
</code></pre>
<p><a href="https://codepen.io/yukap6/pen/NEdNQr"><strong>组合3</strong>（正常）</a></p>
<pre><code>html {
  width: 100%;
  height: 100%;
}
body {
  width: 100%;
  height: 100%;
  overflow: hidden;
}
</code></pre>
<p><a href="https://codepen.io/yukap6/pen/wQgwbM"><strong>组合4</strong>（有 bug）</a></p>
<pre><code>html {
  width: 100%;
  height: 100%;
  overflow: hidden;
}
body {
  width: 100%;
  height: 100%;
  overflow: hidden;
}
</code></pre>
<p>这里大家就会发现，组合1、2、3 都能正常运行，唯独组合4会出现”回到顶部“的 bug，这到底是为什么呢？接下来，就从原理层面来逐层剖析，并进行一一验证。</p>
<h2 id="-2">原理剖析</h2>
<p>这里就不卖关子了，其实，所有的问题都是因为 <a href="https://www.w3.org/TR/CSS21/visufx.html#propdef-overflow"><code>overflow:hidden</code></a> 这个属性值 和 <code>height: 100%</code> 组合不当造成的，且往下看。</p>
<p><a href="https://www.w3.org/TR/CSS21/visufx.html#propdef-overflow">overflow 的定义</a></p>
<blockquote>
  <p>Value:&nbsp;&nbsp;visible | hidden | scroll | auto |&nbsp;inherit
  Initial:&nbsp;&nbsp;visible</p>
</blockquote>
<p>翻译成中文就是：overflow 的取值有 visible、hidden、scroll、auto 四种，默认值为 visible。</p>
<p>每个取值对应的含义如下：</p>
<blockquote>
  <p><strong>visible</strong>
  This value indicates that content is not clipped, i.e., it may be rendered outside the block box.
  <strong>hidden</strong>
  This value indicates that the content is clipped and that no scrolling user interface should be provided to view the content outside the clipping region.
  <strong>scroll</strong>
  This value indicates that the content is clipped and that if the user agent uses a scrolling mechanism that is visible on the screen (such as a scroll bar or a panner), that mechanism should be displayed for a box whether or not any of its content is clipped. This avoids any problem with scrollbars appearing and disappearing in a dynamic environment. When this value is specified and the target medium is 'print', overflowing content may be printed.
  <strong>auto</strong>
  The behavior of the 'auto' value is user agent-dependent, but should cause a scrolling mechanism to be provided for overflowing boxes.</p>
</blockquote>
<p>翻译成中文就是</p>
<ul>
<li>visible 默认值。内容不会被修剪，可以呈现在元素框之外。</li>
<li>hidden 如果需要，内容将被剪裁以适合填充框。 不提供滚动条。</li>
<li>scroll 如果需要，内容将被剪裁以适合填充框。 浏览器显示滚动条，无论是否实际剪切了任何内容。 （这可以防止滚动条在内容更改时出现或消失。）打印机仍可能打印溢出的内容。</li>
<li>auto 取决于用户代理。 如果内容适合填充框内部，则它看起来与可见内容相同，但仍会建立新的块格式化上下文。 如果内容溢出，桌面浏览器会提供滚动条。</li>
</ul>
<p>这里重点关注取值 hidden 的定义 <em>如果需要，内容将被剪裁以适合填充框</em> <strong>不提供滚动条</strong>。请记住这一句，<strong>不提供滚动条</strong>，划重点，要考哟。</p>
<p>接下来逐一分析下之前的解决方案为啥正常，为啥不正常。</p>
<h3 id="1">方案1剖析</h3>
<p><a href="https://codepen.io/yukap6/pen/MzJwrJ">方案1</a> 为什么能达到目标效果呢？<a href="https://codepen.io/yukap6/pen/MzJwrJ">方案1</a> 里，显示模态框的时候，<code>html</code> 元素只是被添加了 <code>overflow: hidden</code> 属性。讨论该方案为什么可行之前，我们先看另一个简单的例子：一般情况下，如何给块级元素应用 <code>overflow: hidden</code> 属性。</p>
<p>大家应该都想到了，需要给块级元素设定固定的宽高之后，添加 <code>overflow: hidden</code> 才能真正生效，如下代码示例，也可以打开 <a href="https://codepen.io/yukap6/pen/wQJBJp">Demo</a> 查看</p>
<pre><code>{
    width: 100px;
    height: 100px;
    overflow: hidden;
}
</code></pre>
<p>去掉设置的固定宽、高之后，如 <a href="https://codepen.io/yukap6/pen/MzpYGd">Demo</a> 所示，内容会全部显示，<code>overflow: hidden</code> 达不到预期效果。这都容易理解，因为块级元素的 <code>width</code> 和 <code>height</code> 默认值为 <code>auto</code>，也就是根据内容自动调节。但是，我们却可以滚动页面来查看所有内容，这就是同 <a href="https://codepen.io/yukap6/pen/MzJwrJ">方案1</a> 不同的地方。<a href="https://codepen.io/yukap6/pen/MzJwrJ">方案1</a> 里也没有设置 html 元素的宽高，但是滚动条却被隐藏了，是浏览器对 html 元素特殊优待了么？</p>
<p>答案当然是 NO。线索还是在 [overflow 的定义里]()，如下这段话</p>
<blockquote>
  <p>UAs must apply the 'overflow' property set on the root element to the viewport. When the root element is an HTML "HTML" element or an XHTML "html" element, and that element has an HTML "BODY" element or an XHTML "body" element as a child, user agents must instead apply the 'overflow' property from the first such child element to the viewport, if the value on the root element is 'visible'. The 'visible' value when used for the viewport must be interpreted as 'auto'. The element from which the value is propagated must have a used value for 'overflow' of 'visible'.</p>
</blockquote>
<p>翻译成中文就是：用户终端（一般就是指浏览器）默认给文档根元素 Html/Body 设置 <code>overflow: visible</code> 属性，根元素所有的子元素也都是默认继承 <code>overflow: visible</code> 属性。但是当根元素的子节点内容超过屏幕限制的时候，根元素要表现的像 <code>overflow: auto</code> 的效果一样，也就是必要的时候还得出现滚动条。</p>
<p>问题迎刃而解。</p>
<p>如 <a href="https://codepen.io/yukap6/pen/MzpYGd">Demo</a> 所示，普通块级元素不固定宽高，只添加 <code>overflow: hidden</code> 的时候，并不能达到 <code>hidden</code> 的效果，而且有滚动条来滚动以查看全部内容。这里的滚动条并不是块级元素本身产生的滚动条，而是浏览器给页面的根元素 Html/Body 提供的滚动条。</p>
<p>而 <a href="https://codepen.io/yukap6/pen/MzJwrJ">方案1</a> 里，之所以没有了滚动条，是因为给 Html 元素添加 <code>overflow: hidden</code> 属性修改了浏览器根元素默认 <code>overflow: visible</code> 的设置以及表现的像 <code>overflow: auto</code> 的效果，从而使根元素 <code>overflow: hidden</code> 生效，而我们还记得，<code>overflow: hidden</code> 的一个要点就是 <strong>不提供滚动条</strong>，所以整个页面背景不再滚动。</p>
<h3 id="2">方案2剖析</h3>
<p>同 <a href="https://codepen.io/yukap6/pen/MzJwrJ">方案1</a>，对于 Body 元素的处理实际上和 Html 的处理几乎一致，所以当给 Body 元素添加 <code>overflow: hidden</code> 的属性时，也能达到预期效果，如 <a href="https://codepen.io/yukap6/pen/eQgpJM">方案2</a> 所示。</p>
<h3 id="3">方案3剖析</h3>
<p>方案3里的 <a href="https://codepen.io/yukap6/pen/wQgGjv"><strong>组合1</strong>（正常）</a> 、<a href="https://codepen.io/yukap6/pen/zMNBGa"><strong>组合2</strong>（正常）</a>以及<a href="https://codepen.io/yukap6/pen/NEdNQr"><strong>组合3</strong>（正常）</a>其实都是使用了如下的原理</p>
<blockquote>
  <p>用户终端（一般就是指浏览器）默认给文档根元素 Html/Body 设置 <code>overflow: visible</code> 属性，根元素所有的子元素也都是默认继承 <code>overflow: visible</code> 属性。但是当根元素的子节点内容超过屏幕限制的时候，根元素要表现的像 <code>overflow: auto</code> 的效果一样，也就是必要的时候还得出现滚动条。</p>
</blockquote>
<p>以 <a href="https://codepen.io/yukap6/pen/NEdNQr"><strong>组合3</strong>（正常）</a> 为例：</p>
<pre><code>html {
  width: 100%;
  height: 100%;
}
body {
  width: 100%;
  height: 100%;
  overflow: hidden;
}
</code></pre>
<p>虽然 html 和 body 元素都设置了宽高值，而且该值就是浏览器的文档可视区域宽高，但并没有出现”回到顶部“的问题。换句话说，就是浏览器仍然可以停留在已滚动到的区域而不重新根据固定宽高来从顶部重新渲染文档，这是因为 html 元素的 <code>overflow</code> 属性并没有被重置，也就是说 html 依然是 <code>overflow: visible</code> 但是表现的像 <code>overflow: auto</code> 的效果，所以文档依然可以表现的是自己已经”滚动“到当前位置，而无需进行裁切隐藏（也就是 <code>overflow: hidden</code>），所要做的只是隐藏掉滚动条而已，因为 body 设置了 <code>overflow: hidden</code>，而 html 元素和 body 元素其实是默认共享了文档顶层滚动条的。</p>
<p>以 <a href="https://codepen.io/yukap6/pen/MzJwrJ">方案1</a> 、<a href="https://codepen.io/yukap6/pen/eQgpJM">方案2</a> 、<a href="https://codepen.io/yukap6/pen/wQgGjv"><strong>组合1</strong>（正常）</a>、<a href="https://codepen.io/yukap6/pen/zMNBGa"><strong>组合2</strong>（正常）</a>、<a href="https://codepen.io/yukap6/pen/NEdNQr"><strong>组合3</strong>（正常）</a>以及如下代码的正常运行都可以证明这一点：html 元素和 body 元素默认共享了文档顶层滚动条。</p>
<pre><code>html {
  width: 100%;
  height: 100%;
  overflow: hidden;
}
body {
  width: 100%;
  height: 100%;
}
</code></pre>
<p>所以，当代码被稍微调整一下，如下所示，模态框弹出的时，html 和 body 同时添加了如下的样式，页面”回到了顶部“（<a href="https://codepen.io/yukap6/pen/wQgwbM">点击查看效果</a>）。</p>
<pre><code>html {
  width: 100%;
  height: 100%;
  overflow: hidden;
}
body {
  width: 100%;
  height: 100%;
  overflow: hidden;
}
</code></pre>
<p>这就是因为文档的宽高被完全重置为了浏览器文档可视区域的高度，而且，文档根元素的 <code>overflow: hidden</code> 真正生效了，所以浏览器对于 html/body 的渲染同普通块级元素设置了固定宽高并且 <code>overflow: hidden</code> 的效果一样，只显示最顶部可显示内容，也就是我们看到的”回到顶部“效果。其实是浏览器对文档进行了重绘，采用了 <code>overflow: hidden</code> 的效果，裁切掉了溢出的部分，并且不提供滚动条。</p>
<p>就酱。</p>
<p>（完）</p>
<p>参考文档</p>
<ul>
<li>https://www.w3.org/TR/CSS21/visufx.html#propdef-overflow</li>
</ul></div></body>

</html>